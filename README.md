# 人事勤假管理
考勤系统
目前的主要功能是计算请假天数
## 年假
年假有如下规则
1. 各个级别都有基础年假天数，例如A级别5天  √
2. 每个人可以手动设定年假，手动设定的年假值 √
3. 刚毕业的学生，入职第一年没有年假（自然年还是计算的年？）√
   设计一个字段，用来保存毕业年份，如果与入职年份一致，则不计年假。
   毕业生自毕业之日起，到第二年同日是没有年假的，从第二年毕业日之后开始，
   当年的年假按剩余的天数与一年的天数（以365记）的比值再乘以员工所属级别或员工专属的年假天数，得到毕业后第二年的年假天数。
   如果入职日期晚于毕业第二年，则以入职日期算，见下一条。
4. 入职不满一年的，以入职当日起一年的剩余天数与一年的天数（以365记）的比值再乘以员工所属级别或员工专属的年假天数，
   得到入职后的年假天数。√

5. 离职的当年年假要按在职时长（即自然月）算√
6. 年假最小单位1天，剩余不足1天的舍去√

7. 上年年假结余，可以延续用到第二年3月31日（可配置），也就是说，年假的有效期是自然年1月1日到配置的结束日期。√
   限定，不允许延续日期跨年，即年假最长有效期不超过2年。√
8. 以结束日期为界限，分开一年，为两个部分，结束日期前优先使用上年结余√

9. 请假时，如果是年假类型，自动计算剩余年假并判断是否可以请假。√


计算结果的导出



1、毕业学生 √
2、年假不进位 √
3、离职年假计算 √
4、入职时间晚于查询期间的，不予查询。√
5、自动计算指定年的结余年假。√


## todo:
 - [] 导出统计结果
 - [] 编辑页面的日期控件问题
 - [] 请假记录页面查询增加日期区间
 - [x] 计算自然年年假结余
 - [] 调级触发年假变化，需要增加调剂生效时间
 - [] 手动调整年假需要设定启用时间
 
 
## 年假

``` 
有效时间不满一年的年假计算规则（入职当年、毕业刚满1年的）
起算日期到12月31日的天数，除以365，得到当年的年假比例。再根据所属级别的对应基数，相乘，取整（仅整数部分）得到当年年假。
起算日期以日志日期或毕业满一年日期，二者取其晚者
入职、毕业第二自然年其，年假比例为 100%

年假比例为 r，
年假为 V，
基数为 b，
起算日期为 ds，
结算日期为 de

r = (de - ds)/365
V = round(r * b)

V = round((de - ds) / 365 * b)

1. 未转正 
   V = 0
2. 未毕业满一年
   V = 0
3. 毕业满一年且已转正 起算日期
  3.1 入职日期与毕业满一年日期取其晚者为 ds （起算日期）
  3.2 入职日期与毕业日期均不在计算当年 ds=1月1日
4. 满足计算年的，结算日期
  4.1 发生离职，结算日期 de = 离职日期
  4.2 正常，结算日期 de = 12月31日
5. 其他情况，有特殊设定的，年假基数按设定取。

```

2023年3月6日
导入请假记录，可选择不自动将年假不足替换为事假
添加请假记录，可选择不自动将年假不足替换为事假

修改请假记录时，要去掉自身的重复。
